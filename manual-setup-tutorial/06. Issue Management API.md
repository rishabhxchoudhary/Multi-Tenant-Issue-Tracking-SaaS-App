# üé´ Part 6: Issue Management API (Amazon API Gateway)

## What We'll Accomplish in This Part

By the end of this tutorial, you will:
- ‚úÖ Understand what API Gateway is and why it's essential for issue tracking systems
- ‚úÖ Create a REST API that connects to your Lambda functions
- ‚úÖ Set up proper API endpoints for issue management (create, read, update, delete issues)
- ‚úÖ Configure CORS for web application access
- ‚úÖ Implement API keys for different subscription tiers
- ‚úÖ Set up usage plans for rate limiting
- ‚úÖ Test your API with real HTTP requests for issue tracking
- ‚úÖ Understand how multi-tenant data isolation works at the API level
- ‚úÖ Have a complete, working API for your issue tracking system

**‚è∞ Estimated Time: 105-120 minutes (about as long as watching a movie with snacks)**

## What is Amazon API Gateway? (Explained Like You're 13)

Think of API Gateway like the **smart receptionist at a busy doctor's office**:

üè• **Without API Gateway** (Chaotic Doctor's Office):
- Patients call doctors directly on their personal phones
- No appointment scheduling system
- No way to check if patients are allowed to see specific doctors
- Doctors get overwhelmed with calls
- No record of who called when

üö™ **With API Gateway** (Professional Medical Center):
- **Reception Desk**: All calls go through one professional receptionist
- **Appointment Book**: Organized system for scheduling and managing requests
- **Patient Verification**: Checks if you're allowed to see specific doctors
- **Call Routing**: Forwards you to the right doctor for your specific problem
- **Record Keeping**: Logs all interactions for billing and quality control
- **Security**: Prevents unauthorized people from bothering doctors

### Real-World Issue Tracker Analogy

**API Gateway is like the Front Desk of Your Issue Tracking Company**:

**When a user wants to create an issue:**
1. **User**: "I need to report a bug in our mobile app"
2. **API Gateway (Receptionist)**: "Let me check your ID... okay, you're John from TechCorp"
3. **API Gateway**: "You're authorized to create issues. Let me connect you to our Issue Creation Department"
4. **Lambda Function (Issue Department)**: Processes the request and saves the issue
5. **API Gateway**: Returns confirmation to John: "Issue #1234 created successfully!"

**Security & Organization**:
- **Company Separation**: TechCorp users can only access TechCorp issues
- **Role Verification**: Only Admins can assign issues to teams
- **Rate Limiting**: Basic tier companies get 1000 API calls per month, Premium gets unlimited
- **Usage Tracking**: Monitors how much each company uses your system

### Why API Gateway for Multi-Tenant Issue Tracking?

**üöÄ Professional Interface**: Clean, documented API that companies can integrate with
**üîí Security**: Built-in authentication, API keys, and rate limiting per company
**üìä Analytics**: Track usage per tenant and API endpoint
**üí∞ Monetization**: Different API limits for different subscription tiers
**üåç Global**: Fast response times worldwide
**üìà Scalable**: Handles 1 API call or 1 million API calls automatically

## Understanding Issue Management APIs

### What Issues Need in a Tracking System

**Core Issue Information**:
- **Title**: "Login button doesn't work on mobile"
- **Description**: Detailed explanation of the problem
- **Status**: Open ‚Üí In Progress ‚Üí In Review ‚Üí Closed
- **Priority**: High, Medium, Low
- **Type**: Bug, Feature Request, Task
- **Assignee**: Who's working on it
- **Reporter**: Who reported the issue
- **Created Date**: When it was created
- **Due Date**: When it should be completed

**Team & Organization**:
- **Team Assignment**: Which team should handle this?
- **Company ID**: Which company does this issue belong to?
- **Labels/Tags**: Frontend, Backend, Mobile, Critical, etc.
- **Comments**: Discussion thread about the issue

### API Endpoints We'll Create

Think of these like different windows at a government office - each one handles specific requests:

**Issue Management Endpoints**:
```
POST /issues           - Create a new issue (like filing a complaint)
GET /issues           - List all issues (like seeing your cases)
GET /issues/{id}      - Get specific issue (like checking case details)
PUT /issues/{id}      - Update an issue (like adding information)
DELETE /issues/{id}   - Delete an issue (like withdrawing a case)
```

**Team Management Endpoints**:
```
POST /teams           - Create a team (like forming a department)
GET /teams           - List all teams (like seeing all departments)
PUT /teams/{id}      - Update team info (like changing department name)
POST /teams/{id}/members - Add member to team (like hiring someone)
DELETE /teams/{id}/members/{userId} - Remove from team (like transferring)
```

**User Management Endpoints**:
```
GET /users           - List users in your company (like employee directory)
PUT /users/{id}/role - Change user role (like promoting someone)
```

## Step 1: Use Your Existing Lambda Function

Great news! We already created a comprehensive issue management Lambda function in **Part 5: First Lambda Function**. Instead of creating multiple separate functions, we'll use the existing `IssueTracker-IssueManager` function that already handles all CRUD operations (Create, Read, Update, Delete) for issues.

### 1.1 Verify Your Existing Function

1. **Sign in** to your AWS Console (as your IAM user)
2. **Search** for `Lambda`
3. **Click "AWS Lambda"**
4. **Find** your existing function: `IssueTracker-IssueManager`

‚úÖ **You should see**:
- **Function name**: `IssueTracker-IssueManager`
- **Runtime**: Python 3.11
- **Status**: Active

### 1.2 Why Use One Function Instead of Many?

**‚ùå Poor Approach (Creating Separate Functions)**:
- `IssueTracker-CreateIssue` - Only creates issues
- `IssueTracker-ListIssues` - Only lists issues  
- `IssueTracker-UpdateIssue` - Only updates issues
- `IssueTracker-DeleteIssue` - Only deletes issues

**Problems**:
- 4 separate functions to maintain
- Duplicate authentication code
- Harder to ensure consistent behavior
- More complex deployment

**‚úÖ Better Approach (One Comprehensive Function)**:
- `IssueTracker-IssueManager` - Handles all issue operations
- Routes HTTP methods: GET, POST, PUT, DELETE
- Single place for authentication logic
- Consistent error handling
- Easier to maintain and deploy

### 1.3 How the Function Handles Different Operations

Our `IssueTracker-IssueManager` function uses **HTTP method routing**:

```
üì® HTTP Request Method ‚Üí üéØ Function Operation

POST /issues        ‚Üí Create new issue
GET /issues         ‚Üí List all issues for company  
GET /issues/{id}    ‚Üí Get specific issue
PUT /issues/{id}    ‚Üí Update existing issue
DELETE /issues/{id} ‚Üí Delete issue
```

This is **industry best practice** used by companies like:
- **GitHub API** - One endpoint, multiple HTTP methods
- **Stripe API** - RESTful design with method routing
- **Atlassian APIs** - Consistent REST patterns
## Step 2: Create API Gateway

Now let's create the "front desk" that will route requests to our Lambda functions.

### 2.1 Access API Gateway

1. **Search** for `API Gateway` in AWS Console
2. **Click "Amazon API Gateway"**
3. **Click "Create API"**

### 2.2 Choose API Type

You'll see different API types:

- **REST API**: ‚úÖ **Choose this one** (most common and flexible)
- **HTTP API**: Simpler but less features
- **WebSocket API**: For real-time features

**Click "Build" under REST API**

### 2.3 Create API Settings

**Create new API:**
- **API name**: `IssueTracker-API`
- **Description**: `REST API for multi-tenant issue tracking system`
- **Endpoint Type**: Regional (best for most cases)

**Click "Create API"**

### 2.4 Create Resources (URL Paths)

Think of resources like different departments in a building. We need:
- `/issues` - For issue management
- `/teams` - For team management  
- `/users` - For user management

**Create Issues Resource:**
1. **Click "Actions" ‚Üí "Create Resource"**
2. **Resource Name**: `issues`
3. **Resource Path**: `/issues` (should auto-fill)
4. ‚úÖ **Enable API Gateway CORS** (allows web apps to call your API)
5. **Click "Create Resource"**

**Create Issue ID Resource:**
1. **Select the `/issues` resource**
2. **Click "Actions" ‚Üí "Create Resource"**
3. **Resource Name**: `issue`
4. **Resource Path**: `/{id}` (the curly braces make it a variable)
5. ‚úÖ **Enable API Gateway CORS**
6. **Click "Create Resource"**

### 2.5 Create Methods (HTTP Verbs)

Methods are like different actions you can take at each department.

**Add POST method to `/issues` (Create Issue):**
1. **Select `/issues` resource**
2. **Click "Actions" ‚Üí "Create Method"**
3. **Choose "POST"** from dropdown
4. **Click the checkmark**

**Method Settings:**
- **Integration type**: Lambda Function
- **Lambda Region**: Your region (like us-east-1)
- **Lambda Function**: `IssueTracker-CreateIssue`
- ‚úÖ **Use Default Timeout**
- **Click "Save"**
- **Click "OK"** when asked about permissions

**Add GET method to `/issues` (List Issues):**
1. **Select `/issues` resource**
2. **Create Method** ‚Üí **GET**
3. **Integration**: Lambda Function
4. **Function**: `IssueTracker-ListIssues`
5. **Click "Save" ‚Üí "OK"**

**Add PUT method to `/issues/{id}` (Update Issue):**
1. **Select `/issues/{id}` resource**
2. **Create Method** ‚Üí **PUT**
3. **Integration**: Lambda Function
4. **Function**: `IssueTracker-UpdateIssue`
5. **Click "Save" ‚Üí "OK"**

### 2.6 Configure CORS (Allow Web Apps)

CORS (Cross-Origin Resource Sharing) lets your web application call your API. Think of it like giving your website permission to talk to your API.

**For each resource (`/issues` and `/issues/{id}`):**
1. **Select the resource**
2. **Click "Actions" ‚Üí "Enable CORS"**
3. **Access-Control-Allow-Origin**: `*` (allows all websites for now)
4. **Access-Control-Allow-Headers**: `Content-Type,X-Amz-Date,Authorization,X-Api-Key,X-Amz-Security-Token`
5. **Access-Control-Allow-Methods**: Select all that apply (GET, POST, PUT, DELETE, OPTIONS)
6. **Click "Enable CORS and replace existing CORS headers"**

## Step 3: Deploy Your API

Your API exists but isn't live yet - like having a restaurant with no open sign.

### 3.1 Create Deployment Stage

1. **Click "Actions" ‚Üí "Deploy API"**
2. **Deployment stage**: [New Stage]
3. **Stage name**: `dev` (for development)
4. **Stage description**: `Development stage for issue tracker API`
5. **Deployment description**: `Initial deployment with issue management endpoints`
6. **Click "Deploy"**

üéâ **Congratulations!** Your API is now live and has a public URL!

### 3.2 Get Your API URL

You'll see something like:
`https://abc123def.execute-api.us-east-1.amazonaws.com/dev`

This is your API's base URL. Your endpoints are:
- `POST https://abc123def.execute-api.us-east-1.amazonaws.com/dev/issues`
- `GET https://abc123def.execute-api.us-east-1.amazonaws.com/dev/issues`
- `PUT https://abc123def.execute-api.us-east-1.amazonaws.com/dev/issues/{id}`

**Write this URL down - you'll need it for testing!**

## Step 4: Set Up Usage Plans and API Keys

This is like setting up different membership levels at a gym - Basic, Premium, Platinum customers get different limits.

### 4.1 Create Usage Plans

1. **In API Gateway**, click **"Usage Plans"** in left sidebar
2. **Click "Create"**

**Basic Tier Plan:**
- **Name**: `BasicTier-UsagePlan`
- **Description**: `Basic tier companies - 1000 requests/month`
- **Throttling**: 
  - Rate: 10 requests/second
  - Burst: 20 requests/second
- **Quota**:
  - 1000 requests per month
  - **Click "Next"**

**Associate with API:**
- **API**: Your `IssueTracker-API`
- **Stage**: `dev`
- **Click "Next"**
- **Click "Done"** (we'll add API keys later)

**Create Premium and Platinum plans** with higher limits:

**Premium Tier:**
- 10,000 requests/month
- 50 requests/second rate
- 100 burst

**Platinum Tier:**
- Unlimited requests
- 200 requests/second rate
- 500 burst

### 4.2 Create API Keys

1. **Click "API Keys"** in left sidebar
2. **Click "Create API Key"**

**Create keys for each tier:**
- **Name**: `BasicTier-APIKey`
- **Description**: `API key for basic tier companies`
- **Click "Save"**

**Associate with Usage Plan:**
1. **Go back to Usage Plans**
2. **Click your BasicTier plan**
3. **Click "API Keys" tab**
4. **Click "Add API Key to Usage Plan"**
5. **Select your BasicTier-APIKey**
6. **Click "Done"**

## Step 5: Test Your API

Let's test your issue tracking API like a real user would!

### 5.1 Test with Postman or curl

**Install Postman** (free API testing tool) or use curl in terminal.

**Test Issue Creation (POST):**

**URL**: `https://your-api-url.execute-api.region.amazonaws.com/dev/issues`
**Method**: POST
**Headers**:
- `Content-Type: application/json`
- `X-API-Key: your-api-key`

**Body** (JSON):
```json
{
    "title": "Login button not working on mobile",
    "description": "When users tap the login button on iPhone, nothing happens",
    "priority": "High",
    "type": "Bug",
    "assignee": "john@techcorp.com",
    "team": "Frontend Team",
    "labels": ["mobile", "urgent", "frontend"]
}
```

**Expected Response**:
```json
{
    "message": "Issue created successfully!",
    "issueId": "123e4567-e89b-12d3-a456-426614174000",
    "issue": {
        "IssueId": "123e4567-e89b-12d3-a456-426614174000",
        "Title": "Login button not working on mobile",
        "Status": "Open",
        "Priority": "High"
    }
}
```

### 5.2 Test Issue Listing (GET)

**URL**: `https://your-api-url.execute-api.region.amazonaws.com/dev/issues`
**Method**: GET
**Headers**: `X-API-Key: your-api-key`

**Expected Response**:
```json
{
    "issues": [
        {
            "IssueId": "123e4567-e89b-12d3-a456-426614174000",
            "Title": "Login button not working on mobile",
            "Status": "Open",
            "Priority": "High",
            "CompanyId": "TECHCORP001"
        }
    ],
    "count": 1,
    "company": "TECHCORP001"
}
```

### 5.3 Test Issue Update (PUT)

**URL**: `https://your-api-url.execute-api.region.amazonaws.com/dev/issues/123e4567-e89b-12d3-a456-426614174000`
**Method**: PUT
**Headers**: 
- `Content-Type: application/json`
- `X-API-Key: your-api-key`

**Body**:
```json
{
    "status": "In Progress",
    "assignee": "sarah@techcorp.com"
}
```

## ‚úÖ Verification Steps

### Test 1: API Gateway Exists
- [ ] Navigate to API Gateway in AWS Console
- [ ] See your `IssueTracker-API`
- [ ] See resources: `/issues` and `/issues/{id}`
- [ ] See methods: POST, GET, PUT

### Test 2: Lambda Functions Work
- [ ] Navigate to Lambda in AWS Console
- [ ] See your three functions: CreateIssue, ListIssues, UpdateIssue
- [ ] Test each function individually using test events

### Test 3: API Deployment Works
- [ ] See your API deployed to `dev` stage
- [ ] Get valid API URL
- [ ] URL format: `https://xxxxxxxxxx.execute-api.region.amazonaws.com/dev`

### Test 4: API Responds to Requests
- [ ] Successfully create an issue via POST
- [ ] Successfully list issues via GET
- [ ] Successfully update an issue via PUT
- [ ] Get proper JSON responses

### Test 5: Usage Plans Active
- [ ] See usage plans for different tiers
- [ ] API keys created and associated with plans
- [ ] Rate limiting and quotas configured

## üö® Troubleshooting Common Issues

### Issue 1: "Internal server error" (500)
**Problem**: Lambda function has errors
**Solution**:
1. Go to CloudWatch Logs
2. Find your function's log group
3. Check the error details
4. Fix code and redeploy

### Issue 2: "Missing Authentication Token"
**Problem**: Wrong API URL or missing API key
**Solution**:
1. Double-check your API URL
2. Make sure you're including X-API-Key header
3. Verify API key is correct

### Issue 3: CORS errors in browser
**Problem**: CORS not properly configured
**Solution**:
1. Go back to API Gateway
2. Enable CORS on all resources
3. Redeploy the API

### Issue 4: "ValidationException" in DynamoDB
**Problem**: DynamoDB table doesn't exist yet
**Solution**: We'll create the DynamoDB table in Part 4, but for testing you can create a simple one

### Issue 5: Lambda can't access DynamoDB
**Problem**: IAM permissions issue
**Solution**:
1. Check that Lambda execution role has DynamoDB permissions
2. Verify the role we created in Part 2 is attached

## üéØ What We Accomplished

Amazing work! You now have:
- ‚úÖ A complete REST API for issue management
- ‚úÖ Lambda functions handling business logic
- ‚úÖ API Gateway routing requests professionally
- ‚úÖ Multi-tenant data isolation (company_id in all operations)
- ‚úÖ Usage plans for different subscription tiers
- ‚úÖ API keys for access control and rate limiting
- ‚úÖ CORS configuration for web app integration
- ‚úÖ Proper error handling and responses
- ‚úÖ A foundation for your complete issue tracking system

### What This Means for Your Issue Tracker

You've built the **"nervous system"** of your issue tracker:
- **Companies can create issues** through your API
- **Data stays separated** by company (TechCorp can't see StartupInc issues)
- **Different tiers get different limits** (Basic: 1000 calls, Premium: 10,000)
- **Professional error handling** with proper HTTP status codes
- **Ready for frontend integration** with CORS enabled
- **Scalable architecture** that can handle growth

## üîú What's Next?

In **Part 7: Team and User Management API**, we'll:
- Create endpoints for team management (create teams, add members)
- Add user role management endpoints
- Implement team assignment functionality
- Create comment and notification APIs
- Add advanced filtering and search capabilities
- Set up real-time notifications for issue updates
- Connect everything together for a complete issue tracking experience

Think of Part 6 as building the **"issue desk"** at your company, and Part 7 as building the **"HR department"** and **"team coordination center"**. Together, they'll make a complete issue tracking system!

**Ready to continue?** Head to [Part 7: Team and User Management API](./7.%20Team%20and%20User%20Management%20API.md)!

---

## üìù Important Information to Save

**API Information**:
- API Name: `IssueTracker-API`
- API ID: `_________________` (find in API Gateway dashboard)
- API URL: `https://__________.execute-api._______.amazonaws.com/dev`
- Stage: `dev`

**Lambda Functions Created**:
- ‚úÖ `IssueTracker-CreateIssue`
- ‚úÖ `IssueTracker-ListIssues`
- ‚úÖ `IssueTracker-UpdateIssue`

**API Keys**:
- BasicTier API Key: `_________________`
- PremiumTier API Key: `_________________`
- PlatinumTier API Key: `_________________`

**API Endpoints**:
- POST `/issues` - Create issue
- GET `/issues` - List issues
- PUT `/issues/{id}` - Update issue
- GET `/issues?status=Open` - Filter by status

*üí° Pro Tip: Save your API URL and test it with Postman. Take screenshots of successful API calls - they'll help you troubleshoot later issues!*

*üéâ Celebrate: You just built a professional REST API that could handle thousands of companies creating millions of issues! This is the same technology that powers apps like Jira, Linear, and Asana!*