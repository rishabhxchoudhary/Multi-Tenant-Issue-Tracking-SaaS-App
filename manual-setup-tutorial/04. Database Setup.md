# 📦 Part 4: Database Setup (Amazon DynamoDB)

## What We'll Accomplish in This Part

By the end of this tutorial, you will:

- ✅ Understand what DynamoDB is and why it's perfect for SaaS applications
- ✅ Learn multi-tenant database design patterns for issue tracking
- ✅ Create DynamoDB tables with proper company isolation
- ✅ Set up indexes for efficient issue querying and team management
- ✅ Implement both pooled and silo database models
- ✅ Test database operations with company-scoped access
- ✅ Understand how data isolation works at the database layer

**⏰ Estimated Time: 90-105 minutes**

## What is Amazon DynamoDB? (Simple Explanation)

Think of DynamoDB like a **super-smart, self-managing filing system**:

🏢 **Traditional Database (like SQL)**:

- Like a rigid filing cabinet with strict folders and labels
- You must organize data in predefined tables and relationships
- Gets slower as it grows bigger
- You manage the filing cabinet hardware

☁️ **DynamoDB**:

- Like a magical filing system that organizes itself
- Stores data as flexible documents (like JSON)
- Gets faster as AWS adds more "filing clerks" automatically
- AWS manages all the hardware for you

### Why DynamoDB for Multi-Tenant Issue Tracking?

**🚀 Speed**: Responds in single-digit milliseconds (perfect for loading issue lists)
**📈 Scale**: Handles millions of issue updates automatically  
**💰 Cost**: Pay only for what you use (great for growing companies)
**🔒 Security**: Built-in encryption and access controls (protect sensitive issue data)
**🌍 Global**: Replicate data worldwide (teams work from anywhere)
**🛠️ Serverless**: No servers to manage (focus on building features)

### DynamoDB vs Traditional Databases

| Traditional SQL Database          | DynamoDB                          |
| --------------------------------- | --------------------------------- |
| Fixed schema (rigid structure)    | Flexible schema (JSON-like)       |
| Requires server management        | Fully managed by AWS              |
| Complex joins between tables      | Simple, fast single-table queries |
| Vertical scaling (bigger servers) | Horizontal scaling (more servers) |
| Good for complex relationships    | Great for simple, fast operations |

## Understanding Multi-Tenant Database Design for Issue Tracking

### The Company Isolation Challenge

In a multi-tenant issue tracking SaaS:

- **Company A** should NEVER see **Company B's** issues, teams, or comments
- Database queries must be lightning-fast (users expect instant issue loading)
- Adding new companies shouldn't slow down existing ones
- Different company tiers might need different performance levels

### Three Multi-Tenant Database Patterns

**1. 🏠 Separate Databases (Silo Model)**

- Each company gets their own database
- Perfect isolation but expensive
- Used for Platinum tier in our solution

**2. 🏢 Shared Database, Separate Tables (Hybrid)**

- All companies share one database
- Each company gets their own set of tables
- Good balance of isolation and cost

**3. 🏬 Shared Database, Shared Tables (Pool Model)**

- All companies share the same tables
- Isolation through application logic and key design
- Most cost-effective, used for Basic/Premium tiers

### Our Issue Tracking Database Architecture

```
🎯 Our Multi-Tenant Strategy:

📊 Pooled Tables (Basic/Premium):
├── CompanyManagement (stores company info and subscription tiers)
├── Issues-Pooled (all companies share, isolated by company_id)
├── Teams-Pooled (all companies share, isolated by company_id)
├── Comments-Pooled (issue discussions, isolated by company_id)
└── Users-Pooled (complement to Cognito user management)

🏛️ Silo Tables (Platinum - per company):
├── Issues-COMPANY_ID (dedicated table per company)
├── Teams-COMPANY_ID (dedicated table per company)
├── Comments-COMPANY_ID (dedicated table per company)
└── Users-COMPANY_ID (dedicated table per company)

🔧 System Tables:
├── CompanyStackMapping (tracks deployments)
└── ApiKeys (manages API access and rate limiting)
```

## Step 1: Understanding DynamoDB Key Concepts for Issue Tracking

### 1.1 Primary Keys (Your Issue Filing System)

**Partition Key**: Like the main folder label

- Determines which "filing cabinet" (server) stores the data
- Must be unique for each item
- Example: `COMPANY001#ISSUE#ISS-12345`

**Sort Key** (optional): Like sub-folder organization

- Sorts items within the same partition
- Enables range queries
- Example: `2024-01-15#CREATED` or `HIGH#PRIORITY`

### 1.2 Our Company Isolation Strategy

**For Pooled Tables**: Use company ID in the partition key

```
Partition Key: "COMPANY001#ISSUE#ISS-12345"
Sort Key: "2024-01-15"
Data: {
  title: "Login page not loading",
  priority: "High",
  assignee: "john@company001.com",
  company_id: "COMPANY001"
}
```

**Why this works**:

- DynamoDB automatically separates data by partition key
- Company A queries never see Company B issues
- Lightning-fast lookups within each company
- Perfect for issue tracking where teams need instant access to their issues

### 1.3 Indexes (Finding Issues Fast)

**Global Secondary Index (GSI)**: Like alternative filing systems

- Lets you query issues in different ways
- Examples:
  - Find all issues assigned to "john@company.com"
  - Find all "High" priority issues
  - Find all issues in "In Progress" status
  - Find all issues assigned to "Backend Team"

## Step 2: Create System Management Tables

Let's start with tables that manage our issue tracking SaaS system itself.

### 2.1 Access DynamoDB Service

1. **Sign in** to AWS Console (as your IAM user)
2. **Search** for `DynamoDB`
3. Click **"DynamoDB"**
4. You'll see the DynamoDB dashboard

### 2.2 Create Company Management Table

This table stores information about each company using our issue tracking SaaS.

1. Click **"Create table"**

**Table Details:**

- **Table name**: `IssueTracker-CompanyManagement`
- **Partition key**: `company_id` (String)
- **Sort key**: ❌ **Leave blank** (we don't need it for this table)

**Table Settings:**

- **Table class**: `DynamoDB Standard`
- **Capacity mode**: `On-demand` (AWS automatically scales)
- **Encryption**: `Owned by Amazon DynamoDB` (default encryption)

**Tags** (optional but helpful):

- **Key**: `Project` **Value**: `IssueTrackingSaaS`
- **Key**: `Environment` **Value**: `Development`

Click **"Create table"**

⏳ **Wait for table creation** (usually takes 1-2 minutes)

### 2.3 Create Company Stack Mapping Table

This table tracks which infrastructure belongs to which company.

1. Click **"Create table"** again

**Table Details:**

- **Table name**: `IssueTracker-CompanyStackMapping`
- **Partition key**: `company_id` (String)
- **Sort key**: `stack_name` (String)

**Table Settings:** (same as before)

- **Capacity mode**: `On-demand`
- **Encryption**: Default

Click **"Create table"**

### 2.4 Create API Keys Management Table

This tracks API keys and rate limiting for different company tiers.

1. **Create table**

**Table Details:**

- **Table name**: `IssueTracker-ApiKeys`
- **Partition key**: `tier_name` (String)
- **Sort key**: `key_id` (String)

**Table Settings:**

- **Capacity mode**: `On-demand`
- **Encryption**: Default

Click **"Create table"**

## Step 3: Create Pooled Application Tables

These tables will be shared by Basic and Premium tier companies.

### 3.1 Create Pooled Issues Table

This is the heart of our issue tracking system!

1. **Create table**

**Table Details:**

- **Table name**: `IssueTracker-Issues-Pooled`
- **Partition key**: `company_issue_id` (String)
  - Format will be: `COMPANY001#ISSUE#ISS-12345`
- **Sort key**: ❌ **No sort key needed**

**Global Secondary Indexes:**
We need multiple GSIs to query issues in different ways.

Click **"Create global secondary index"**

**GSI 1 - Query by Company and Status:**

- **Index name**: `CompanyStatusIndex`
- **Partition key**: `company_id` (String)
- **Sort key**: `status` (String)
- **Projected attributes**: `All attributes`

**GSI 2 - Query by Assignee:**

- **Index name**: `AssigneeIndex`
- **Partition key**: `company_id` (String)
- **Sort key**: `assigned_user` (String)
- **Projected attributes**: `All attributes`

**GSI 3 - Query by Team:**

- **Index name**: `TeamIndex`
- **Partition key**: `company_id` (String)
- **Sort key**: `assigned_team` (String)
- **Projected attributes**: `All attributes`

**GSI 4 - Query by Priority:**

- **Index name**: `PriorityIndex`
- **Partition key**: `company_id` (String)
- **Sort key**: `priority` (String)
- **Projected attributes**: `All attributes`

**Table Settings:**

- **Capacity mode**: `On-demand`

Click **"Create table"**

### 3.2 Create Pooled Teams Table

Teams help organize users and assign issues to groups.

1. **Create table**

**Table Details:**

- **Table name**: `IssueTracker-Teams-Pooled`
- **Partition key**: `company_team_id` (String)
  - Format: `COMPANY001#TEAM#TEAM-67890`
- **Sort key**: ❌ **No sort key**

**Global Secondary Indexes:**

**GSI 1 - Query by Company:**

- **Index name**: `CompanyIndex`
- **Partition key**: `company_id` (String)
- **Sort key**: `created_date` (String)
- **Projected attributes**: `All attributes`

**GSI 2 - Query by Team Lead:**

- **Index name**: `TeamLeadIndex`
- **Partition key**: `company_id` (String)
- **Sort key**: `team_lead` (String)
- **Projected attributes**: `All attributes`

Click **"Create table"**

### 3.3 Create Pooled Comments Table

Comments enable discussions and collaboration on issues.

1. **Create table**

**Table Details:**

- **Table name**: `IssueTracker-Comments-Pooled`
- **Partition key**: `company_comment_id` (String)
  - Format: `COMPANY001#COMMENT#CMT-11111`
- **Sort key**: `created_date` (String)

**Global Secondary Indexes:**

**GSI 1 - Query Comments by Issue:**

- **Index name**: `IssueIndex`
- **Partition key**: `company_issue_id` (String)
- **Sort key**: `created_date` (String)
- **Projected attributes**: `All attributes`

**GSI 2 - Query Comments by User:**

- **Index name**: `UserIndex`
- **Partition key**: `company_id` (String)
- **Sort key**: `author_email` (String)
- **Projected attributes**: `All attributes`

Click **"Create table"**

### 3.4 Create User Management Table

This complements Cognito with additional user data and role information.

1. **Create table**

**Table Details:**

- **Table name**: `IssueTracker-Users-Pooled`
- **Partition key**: `company_user_id` (String)
  - Format: `COMPANY001#USER#user@example.com`
- **Sort key**: ❌ **No sort key**

**Global Secondary Indexes:**

**GSI 1 - Query by Company:**

- **Index name**: `CompanyIndex`
- **Partition key**: `company_id` (String)
- **Sort key**: `last_login_date` (String)
- **Projected attributes**: `All attributes`

**GSI 2 - Query by Email:**

- **Index name**: `EmailIndex`
- **Partition key**: `email` (String)
- **Sort key**: ❌ **No sort key**
- **Projected attributes**: `All attributes`

**GSI 3 - Query by Role:**

- **Index name**: `RoleIndex`
- **Partition key**: `company_id` (String)
- **Sort key**: `user_role` (String)
- **Projected attributes**: `All attributes`

Click **"Create table"**

## Step 4: Add Sample Data

Let's add some test data to understand how company isolation works in our issue tracking system.

### 4.1 Add Sample Company Data

1. Click on the **"IssueTracker-CompanyManagement"** table
2. Click **"Explore table items"**
3. Click **"Create item"**

**Company 1 - Basic Tier:**

```json
{
  "company_id": "COMPANY001",
  "company_name": "TechStart Solutions",
  "company_tier": "Basic",
  "contact_email": "admin@techstart.com",
  "subscription_status": "active",
  "created_date": "2024-01-15",
  "monthly_quota": 1000,
  "api_calls_used": 245,
  "max_users": 5,
  "current_users": 3
}
```

**How to add this:**

1. **Partition key value**: `COMPANY001`
2. Click **"Add new attribute"** for each field:

   - **company_name** (String): `TechStart Solutions`
   - **company_tier** (String): `Basic`
   - **contact_email** (String): `admin@techstart.com`
   - **subscription_status** (String): `active`
   - **created_date** (String): `2024-01-15`
   - **monthly_quota** (Number): `1000`
   - **api_calls_used** (Number): `245`
   - **max_users** (Number): `5`
   - **current_users** (Number): `3`

3. Click **"Create item"**

**Company 2 - Premium Tier:**
Repeat the process with:

```json
{
  "company_id": "COMPANY002",
  "company_name": "DevCorp Enterprise",
  "company_tier": "Premium",
  "contact_email": "admin@devcorp.com",
  "subscription_status": "active",
  "created_date": "2024-01-10",
  "monthly_quota": 10000,
  "api_calls_used": 3456,
  "max_users": 25,
  "current_users": 12
}
```

### 4.2 Add Sample Issues Data

1. Go to **"IssueTracker-Issues-Pooled"** table
2. **"Explore table items"** → **"Create item"**

**Issue 1 - Company001:**

```json
{
  "company_issue_id": "COMPANY001#ISSUE#ISS-001",
  "company_id": "COMPANY001",
  "issue_id": "ISS-001",
  "title": "User login page loading slowly",
  "description": "Users reporting that the login page takes more than 5 seconds to load",
  "status": "Open",
  "priority": "High",
  "issue_type": "Bug",
  "assigned_user": "john@techstart.com",
  "assigned_team": "TEAM-001",
  "reporter": "sarah@techstart.com",
  "created_date": "2024-01-15",
  "updated_date": "2024-01-15",
  "due_date": "2024-01-20",
  "labels": ["performance", "login", "urgent"],
  "estimated_hours": 8,
  "story_points": 3
}
```

**Issue 2 - Company002:**

```json
{
  "company_issue_id": "COMPANY002#ISSUE#ISS-001",
  "company_id": "COMPANY002",
  "issue_id": "ISS-001",
  "title": "Add dark mode theme option",
  "description": "Users have requested a dark mode theme for better viewing experience",
  "status": "In Progress",
  "priority": "Medium",
  "issue_type": "Feature",
  "assigned_user": "mike@devcorp.com",
  "assigned_team": "TEAM-002",
  "reporter": "admin@devcorp.com",
  "created_date": "2024-01-10",
  "updated_date": "2024-01-12",
  "due_date": "2024-02-01",
  "labels": ["ui", "enhancement", "user-request"],
  "estimated_hours": 16,
  "story_points": 5
}
```

Notice how both companies can have `issue_id: ISS-001`, but they're completely isolated by the `company_issue_id` partition key!

### 4.3 Add Sample Teams Data

1. Go to **"IssueTracker-Teams-Pooled"** table
2. Create items:

**Team 1 - Company001:**

```json
{
  "company_team_id": "COMPANY001#TEAM#TEAM-001",
  "company_id": "COMPANY001",
  "team_id": "TEAM-001",
  "team_name": "Backend Development",
  "description": "Responsible for server-side development and APIs",
  "team_lead": "john@techstart.com",
  "members": ["john@techstart.com", "sarah@techstart.com"],
  "created_date": "2024-01-15",
  "status": "active",
  "max_members": 5,
  "current_workload": 15
}
```

**Team 2 - Company002:**

```json
{
  "company_team_id": "COMPANY002#TEAM#TEAM-002",
  "company_id": "COMPANY002",
  "team_id": "TEAM-002",
  "team_name": "Frontend Experience",
  "description": "UI/UX design and frontend development",
  "team_lead": "mike@devcorp.com",
  "members": ["mike@devcorp.com", "lisa@devcorp.com", "alex@devcorp.com"],
  "created_date": "2024-01-10",
  "status": "active",
  "max_members": 8,
  "current_workload": 22
}
```

### 4.4 Add Sample Comments Data

1. Go to **"IssueTracker-Comments-Pooled"** table
2. Create items:

**Comment 1 - On Issue ISS-001 from Company001:**

```json
{
  "company_comment_id": "COMPANY001#COMMENT#CMT-001",
  "company_issue_id": "COMPANY001#ISSUE#ISS-001",
  "company_id": "COMPANY001",
  "comment_id": "CMT-001",
  "author_email": "john@techstart.com",
  "author_name": "John Smith",
  "content": "I've identified the issue - it's related to the database connection timeout. Working on a fix.",
  "created_date": "2024-01-15T14:30:00Z",
  "is_internal": false,
  "attachments": [],
  "mentions": ["sarah@techstart.com"]
}
```

**Comment 2 - On Issue ISS-001 from Company002:**

```json
{
  "company_comment_id": "COMPANY002#COMMENT#CMT-001",
  "company_issue_id": "COMPANY002#ISSUE#ISS-001",
  "company_id": "COMPANY002",
  "comment_id": "CMT-001",
  "author_email": "mike@devcorp.com",
  "author_name": "Mike Johnson",
  "content": "Dark mode mockups are ready for review. The color palette looks great!",
  "created_date": "2024-01-12T09:15:00Z",
  "is_internal": false,
  "attachments": ["darkmode-mockup.png"],
  "mentions": ["lisa@devcorp.com"]
}
```

## Step 5: Test Company Isolation

Let's verify that our company isolation is working correctly for our issue tracking system.

### 5.1 Query Data by Company

**Test 1 - Get All Issues for Company001:**

1. Go to **"IssueTracker-Issues-Pooled"** table
2. Click **"Scan or query items"**
3. Select **"Query"**
4. **Index**: Select `CompanyStatusIndex`
5. **Partition key**: `company_id` = `COMPANY001`
6. Click **"Run"**

✅ **Result**: Should only see issues belonging to COMPANY001

**Test 2 - Get All Teams for Company002:**

1. Go to **"IssueTracker-Teams-Pooled"** table
2. **Query** with `CompanyIndex`
3. **Partition key**: `company_id` = `COMPANY002`
4. ✅ **Result**: Should only see COMPANY002 teams

### 5.2 Test Cross-Company Isolation

**Test 3 - Try to Access Another Company's Issues:**

1. In **"IssueTracker-Issues-Pooled"** table
2. **Query** with `AssigneeIndex`
3. **Partition key**: `company_id` = `COMPANY001`
4. **Sort key**: `assigned_user` = `john@techstart.com`
5. ✅ **Result**: Only COMPANY001 issues assigned to John appear

The key insight: **Each company can only see their own issues, teams, and comments**, even though it's all in the same tables!

### 5.3 Test Index Performance for Issue Tracking

**Test 4 - Query High Priority Issues:**

1. **"IssueTracker-Issues-Pooled"** → **Query**
2. **Index**: `PriorityIndex`
3. **Partition key**: `company_id` = `COMPANY001`
4. **Sort key**: `priority` = `High`
5. ✅ **Result**: Fast query showing only COMPANY001's high priority issues

**Test 5 - Query Comments for Specific Issue:**

1. **"IssueTracker-Comments-Pooled"** → **Query**
2. **Index**: `IssueIndex`
3. **Partition key**: `company_issue_id` = `COMPANY001#ISSUE#ISS-001`
4. ✅ **Result**: All comments for that specific issue, sorted by date

## Step 6: Create Silo Tables (Platinum Tier)

Platinum tier companies get their own dedicated tables for complete isolation and enhanced performance.

### 6.1 Create Template for Silo Tables

**Issues Table for Platinum Company:**

1. **Create table**

- **Table name**: `IssueTracker-Issues-PLATINUM-TEMPLATE`
- **Partition key**: `issue_id` (String)
- **Sort key**: `created_date` (String)

**Indexes:**

- **StatusIndex**: `status` (partition), `priority` (sort)
- **AssigneeIndex**: `assigned_user` (partition), `due_date` (sort)
- **TeamIndex**: `assigned_team` (partition), `updated_date` (sort)

**Teams Table for Platinum Company:**

1. **Create table**

- **Table name**: `IssueTracker-Teams-PLATINUM-TEMPLATE`
- **Partition key**: `team_id` (String)
- **Sort key**: `created_date` (String)

**Indexes:**

- **LeadIndex**: `team_lead` (partition), `created_date` (sort)
- **StatusIndex**: `status` (partition), `team_name` (sort)

**Comments Table for Platinum Company:**

1. **Create table**

- **Table name**: `IssueTracker-Comments-PLATINUM-TEMPLATE`
- **Partition key**: `issue_id` (String)
- **Sort key**: `created_date` (String)

**Indexes:**

- **AuthorIndex**: `author_email` (partition), `created_date` (sort)

### 6.2 Understanding the Difference

**Pooled Tables** (Basic/Premium):

- All companies share the same tables
- Company isolation through partition key design
- Cost-effective for many small companies
- Shared performance characteristics

**Silo Tables** (Platinum):

- Each company gets dedicated tables
- Complete data isolation and security
- Can have custom performance settings per company
- Higher cost but maximum isolation and performance
- Perfect for large enterprises with strict compliance requirements

## Step 7: Set Up Table Security and Monitoring

### 7.1 Enable Point-in-Time Recovery

For production data protection (critical for issue tracking data):

1. For each important table, click the table name
2. Go to **"Backups"** tab
3. Click **"Edit"** under Point-in-time recovery
4. ✅ **Enable point-in-time recovery**
5. Click **"Save changes"**

This allows you to restore issue data to any point in the last 35 days!

### 7.2 Set Up CloudWatch Monitoring

1. In any table, go to **"Monitoring"** tab
2. You'll see built-in metrics:
   - **Read/Write capacity consumption**
   - **Throttled requests** (important for issue loading performance)
   - **System errors**

### 7.3 Configure Table-Level Permissions

Our tables will use the IAM roles we created in Part 2, but let's verify:

1. Go to **IAM** → **Roles** → **"IssueTracker-Lambda-ExecutionRole"**
2. Check the **"Permissions"** tab
3. ✅ Should see `AmazonDynamoDBFullAccess` attached

## ✅ Verification Steps

Let's ensure everything is working correctly:

### Test 1: All Tables Created

- [ ] Navigate to DynamoDB → Tables
- [ ] See all 7 tables:
  - `IssueTracker-CompanyManagement`
  - `IssueTracker-CompanyStackMapping`
  - `IssueTracker-ApiKeys`
  - `IssueTracker-Issues-Pooled`
  - `IssueTracker-Teams-Pooled`
  - `IssueTracker-Comments-Pooled`
  - `IssueTracker-Users-Pooled`

### Test 2: Sample Data Added

- [ ] Each pooled table has sample issue tracking data
- [ ] Data includes proper company_id fields
- [ ] Partition keys follow the pattern: `COMPANYXXX#TYPE#ID`

### Test 3: Indexes Working

- [ ] Query issues by company using CompanyStatusIndex
- [ ] Query teams by company using CompanyIndex
- [ ] Query comments by issue using IssueIndex
- [ ] All queries return results in under 100ms

### Test 4: Company Isolation Verified

- [ ] COMPANY001 queries only return COMPANY001 data
- [ ] COMPANY002 queries only return COMPANY002 data
- [ ] No cross-company data leakage in issues, teams, or comments

### Test 5: Issue Tracking Queries Work

- [ ] Can find high priority issues quickly
- [ ] Can filter issues by assignee
- [ ] Can load all comments for an issue
- [ ] Can query teams and their members

### Test 6: Monitoring Active

- [ ] CloudWatch metrics visible for each table
- [ ] Point-in-time recovery enabled on critical tables

## 🔧 Understanding Database Performance for Issue Tracking

### DynamoDB Performance Characteristics

| Operation        | Typical Latency | Use Case                    |
| ---------------- | --------------- | --------------------------- |
| **GetItem**      | 1-2ms           | Get single issue by ID      |
| **Query**        | 2-5ms           | Get all issues for a team   |
| **Scan**         | 10-100ms        | Full table search (avoid)   |
| **BatchGetItem** | 5-10ms          | Get multiple issues at once |

### Capacity Planning for Issue Tracking

**On-Demand Pricing** (what we're using):

- **Reads**: $0.25 per million requests
- **Writes**: $1.25 per million requests
- **Storage**: $0.25 per GB per month

**Example Monthly Cost** for a company with 1,000 issues:

- **Issue Creation**: 1,000 writes × $1.25 / 1M = $0.001
- **Issue Views**: 50,000 reads × $0.25 / 1M = $0.01
- **Comments**: 5,000 writes × $1.25 / 1M = $0.006
- **Storage**: ~10MB × $0.25/GB = $0.003
- **Total**: About $0.02/month per 1,000 issues!

## 🚨 Troubleshooting Common Issues

### Issue 1: Table creation fails

**Problem**: Insufficient permissions
**Solution**:

1. Verify you're signed in as IAM user with DynamoDB permissions
2. Check IAM user has AdministratorAccess policy

### Issue 2: Can't create GSI

**Problem**: Table already has data with different key structure
**Solution**:

1. Delete all items from table
2. Add the GSI
3. Re-add data with proper attributes

### Issue 3: Query returns no results

**Problem**: Wrong index or partition key format
**Solution**:

1. Verify partition key format exactly matches: `COMPANY001#ISSUE#ISS-001`
2. Check you're using the correct GSI
3. Ensure sample data was added correctly

### Issue 4: "Throttling" errors

**Problem**: Too many requests too fast (common during issue import)
**Solution**:

1. On-demand tables auto-scale but need warm-up
2. Add exponential backoff to retry failed requests
3. Consider provisioned capacity for predictable workloads

### Issue 5: High costs

**Problem**: Inefficient query patterns
**Solution**:

1. Use Query instead of Scan operations
2. Project only needed attributes in GSIs
3. Monitor CloudWatch metrics for usage patterns
4. Cache frequently accessed issue data

### Issue 6: Can't add issue/comment

**Problem**: Missing required attributes or wrong data types
**Solution**:

1. Verify partition key is String type
2. Check JSON format is valid
3. Ensure all required attributes are present
4. Verify company_id format is consistent

## 🎯 What We Accomplished

Outstanding work! You now have:

- ✅ A complete multi-tenant issue tracking database architecture
- ✅ Proper company isolation at the data layer
- ✅ Efficient indexes for fast issue, team, and comment queries
- ✅ Both pooled and silo models for different company tiers
- ✅ Sample data demonstrating company separation
- ✅ Performance monitoring and backup protection
- ✅ Understanding of DynamoDB best practices for issue tracking
- ✅ Cost-effective, scalable data storage for growing companies

## 🏗️ Multi-Tenant Issue Tracking Database Architecture We Built

```
📊 Issue Tracking Data Architecture:

🔄 Pooled Model (Basic/Premium):
├── Single tables shared by multiple companies
├── Company isolation via partition key design
├── Format: COMPANY_ID#ENTITY_TYPE#ENTITY_ID
├── Cost-effective for high company volume
└── Examples: IssueTracker-Issues-Pooled, IssueTracker-Teams-Pooled, IssueTracker-Comments-Pooled

🏛️ Silo Model (Platinum):
├── Dedicated tables per company
├── Complete data isolation and security
├── Custom performance tuning per company
├── Higher cost, maximum isolation
└── Examples: IssueTracker-Issues-COMPANY_ID, IssueTracker-Teams-COMPANY_ID

🔍 Query Patterns for Issue Tracking:
├── Single company data access (company_id partition)
├── Fast issue filtering by status, priority, assignee
├── Team-based issue assignment and workload tracking
├── Comment threading and discussion history
├── Cross-entity relationships within company only
├── Fast lookups via Global Secondary Indexes
└── No cross-company data access possible

📋 Issue Tracking Entities:
├── Issues: Bug reports, feature requests, tasks
├── Teams: Groups of users working together
├── Comments: Discussions and updates on issues
├── Users: Team members with roles (User/Admin/Super Admin)
└── Companies: Isolated workspaces with subscription tiers
```

## 🔜 What's Next?

In **Part 5: First Lambda Function**, we'll:

- Create our first serverless function to interact with the issue tracking database
- Build an issue management API endpoint
- Implement company-aware data operations
- Connect our Lambda function to DynamoDB
- Test serverless business logic for creating and managing issues
- Add proper error handling and logging
- Understand the Lambda execution environment

Think of this as building the "workers" for our issue tracking SaaS - pieces of code that will handle:

- Creating new issues with proper company isolation
- Updating issue status (Open → In Progress → Closed)
- Assigning issues to users or teams
- Managing user roles and permissions
- Ensuring data security between companies

The Lambda functions will use the IAM roles we created in Part 2 and the user context from Part 3 to ensure that each company can only access their own issues, teams, and comments in the database we just set up.

**Ready to write some code?** Head to [Part 5: First Lambda Function](./05.%20First%20Lambda%20Function.md)!

---

## 📝 Important Information to Save

**Database Table Names**:

- ✅ `IssueTracker-CompanyManagement`
- ✅ `IssueTracker-CompanyStackMapping`
- ✅ `IssueTracker-ApiKeys`
- ✅ `IssueTracker-Issues-Pooled`
- ✅ `IssueTracker-Teams-Pooled`
- ✅ `IssueTracker-Comments-Pooled`
- ✅ `IssueTracker-Users-Pooled`

**Key Design Patterns for Issue Tracking**:

- **Pooled Tables**: `COMPANY_ID#ENTITY_TYPE#ENTITY_ID`
- **Company Isolation**: All queries include company_id
- **GSI Strategy**: company_id as partition key for company-scoped queries
- **Issue Status Flow**: Open → In Progress → In Review → Closed
- **User Role Hierarchy**: User → Admin → Super Admin → Root User

**Sample Company IDs**:

- COMPANY001 (Basic tier - TechStart Solutions)
- COMPANY002 (Premium tier - DevCorp Enterprise)

**Sample Issue Tracking Data**:

- Issues: ISS-001, ISS-002 with different priorities and statuses
- Teams: Backend Development, Frontend Experience
- Comments: Threaded discussions on issues
- Users: Role-based access (User/Admin/Super Admin)

**Performance Expectations**:

- Single issue retrieval: 1-2ms
- Company-scoped issue queries: 2-5ms
- Team workload queries: 3-8ms
- Comment loading: 5-15ms per issue
- Cross-company isolation: 100% guaranteed

**Global Secondary Indexes Created**:

- **Issues**: CompanyStatusIndex, AssigneeIndex, TeamIndex, PriorityIndex
- **Teams**: CompanyIndex, TeamLeadIndex
- **Comments**: IssueIndex, UserIndex
- **Users**: CompanyIndex, EmailIndex, RoleIndex

_💡 Pro Tip: Save screenshots of your issue, team, and comment data structures - you'll reference these when building Lambda functions for issue management, team assignment, and role-based permissions!_

_🎯 Remember: Each company is completely isolated - Company A can never see Company B's issues, teams, or comments, even though they share the same database tables. This is the magic of our partition key design!_
